<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>11 - Shopping Cart</title>
  <script type="module" src="../../dist/aft.js"></script>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 600px; margin: 2rem auto; padding: 0 1rem; }
    .item { display: grid; grid-template-columns: 1fr auto auto auto; gap: 1rem;
            align-items: center; padding: 0.75rem; border-bottom: 1px solid #eee; }
    .item-name { font-weight: 500; }
    .item-price { color: #666; }
    input[type="number"] { width: 60px; padding: 0.25rem; font-size: 1rem; text-align: center; }
    .subtotal { font-weight: 500; min-width: 80px; text-align: right; }
    .total-row { display: flex; justify-content: space-between; padding: 1rem;
                 background: #f5f5f5; border-radius: 4px; margin-top: 1rem; font-size: 1.2rem; }
    .total-amount { font-weight: bold; color: #2e7d32; }
    .actions { margin-top: 1rem; display: flex; gap: 0.5rem; }
    button { padding: 0.5rem 1rem; font-size: 1rem; cursor: pointer; border: 1px solid #ccc;
             background: white; border-radius: 4px; }
    button:hover { background: #f5f5f5; }
    .remove-btn { color: #999; border: none; background: none; font-size: 1.2rem; }
    .remove-btn:hover { color: #f44336; }
    .empty { text-align: center; color: #999; padding: 2rem; }
  </style>
</head>
<body>

<aft-form>
  <aft-data>
  {
    "items": [
      {"name": "Organic Apples", "price": 4.99, "qty": 2},
      {"name": "Sourdough Bread", "price": 6.50, "qty": 1},
      {"name": "Aged Cheddar", "price": 8.99, "qty": 1},
      {"name": "Free-range Eggs", "price": 5.99, "qty": 2}
    ],
    "taxRate": 0.08
  }
  </aft-data>

  <aft-bind name="subtotal" calc="items.reduce((sum, i) => sum + i.price * i.qty, 0)"></aft-bind>
  <aft-bind name="tax" calc="subtotal * taxRate"></aft-bind>
  <aft-bind name="total" calc="subtotal + tax"></aft-bind>
  <aft-bind name="itemCount" calc="items.reduce((sum, i) => sum + i.qty, 0)"></aft-bind>

  <h1>Shopping Cart</h1>
  <p aft-text="`${itemCount} item${itemCount !== 1 ? 's' : ''} in your cart`"></p>

  <div aft-if="items.length > 0">
    <div class="item" aft-each="items" aft-as="item" aft-index-as="i">
      <span class="item-name" aft-text="item.name"></span>
      <span class="item-price">$<span aft-text="item.price.toFixed(2)"></span></span>
      <input type="number" aft-ref="item.qty" min="1" max="99">
      <span class="subtotal">$<span aft-text="(item.price * item.qty).toFixed(2)"></span></span>
      <button class="remove-btn" aft-click="items.splice(i, 1)">Ã—</button>
    </div>

    <div class="total-row" style="background: #fafafa;">
      <span>Subtotal</span>
      <span>$<span aft-text="subtotal.toFixed(2)"></span></span>
    </div>
    <div class="total-row" style="background: #fafafa; font-size: 1rem;">
      <span>Tax (<span aft-text="(taxRate * 100).toFixed(0)"></span>%)</span>
      <span>$<span aft-text="tax.toFixed(2)"></span></span>
    </div>
    <div class="total-row">
      <span>Total</span>
      <span class="total-amount">$<span aft-text="total.toFixed(2)"></span></span>
    </div>

    <div class="actions">
      <button aft-click="items.push({name: 'New Item', price: 0, qty: 1})">
        Add Item
      </button>
      <button aft-click="items.length = 0">
        Clear Cart
      </button>
    </div>
  </div>

  <p class="empty" aft-if="items.length === 0">
    Your cart is empty.
    <br><br>
    <button aft-click="items.push({name: 'Sample Item', price: 9.99, qty: 1})">
      Add Sample Item
    </button>
  </p>
</aft-form>

</body>
</html>
